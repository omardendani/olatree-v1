import{r as g,j as I}from"./index-vo7b5pTF.js";import{u as W,g as $,D as A}from"./useDragLogic-ghLGXMQH.js";import{normalizeDeviceType as N,useDeviceType as R}from"./useDeviceType-BP0CgOJQ.js";import{GENERAL_CONFIG as S,BENTO_ITEMS as y,GRID_CONFIG as L}from"./bentoConfig-Cp6bUGGj.js";import{useDivWidth as O}from"./useDivWidth-CXi6mTzl.js";import{useCollisionSystem as U}from"./useCollisionSystem-Bx_zFclq.js";import{useGridCalculations as M}from"./useGridCalculations-DvdjQKpD.js";import B from"./DraggableItem-P8dL5kH_.js";import"./helpers-DDBqhmc4.js";import"./Items-DBZYWXk6.js";import"./Actions-c2_LpuD2.js";import"./getSiteInfo-BU7_39vT.js";$.registerPlugin(A);function tt(){const s=N(R());function G(t,o){const c=L[t==null?void 0:t.toUpperCase()];return c?o in c?c[o]:(console.warn(`Key "${o}" is not found in GRID_CONFIG.${t}.`),null):(console.warn(`Device type "${t}" is not defined in GRID_CONFIG.`),null)}const r=N(s),{divRef:x,width:i}=O(),[D,P]=g.useState(0),w=g.useRef(i),f=S.BENTO_GRID_GAP,E=G(s,"MAX_COLUMNS"),n=M(i,f,E),e=U(n),u=g.useRef({isDragging:!1,draggedItemId:null,previewElements:new Set,previewPositions:{},currentPositions:y.map((t,o)=>({id:o,x:t.position[r].x,y:t.position[r].y,width:t.style[r].w,height:t.style[r].h}))}),p=g.useCallback(t=>{let o=0;t.forEach(_=>{const C=_.y+_.height;C>o&&(o=C)});const{bento_fr:c,bento_gap:m,btm_margin:b}=n;let d=c*o;return o>1&&(d=c*o+m*(o-1)),d+b},[n]),h=g.useCallback(()=>{if(a.getCurrentPositions){const t=a.getCurrentPositions(),o=p(t);P(o)}},[p]),a=W(i,n,e,h),l=g.useMemo(()=>i===0?[]:y.map((t,o)=>{const{h:c,w:m}=t.style[r],{x:b,y:d}=t.position[r],{height:_,width:C}=n.calculateItemDimensions(c,m),{x:H,y:j}=n.calculateItemPosition(b,d),F=`translate(${H}px, ${j}px)`;return I.jsx(B,{item:t,index:o,transform:F,height:_,width:C,isDragging:a.isDragging?a.isDragging():!1,"data-draggable-id":o},o)}),[i,n,u.isDragging]);return g.useEffect(()=>{i>0&&h()},[i,h]),g.useEffect(()=>{i>0&&w.current!==i&&w.current>0&&((a.getCurrentPositions?a.getCurrentPositions():[]).forEach((o,c)=>{const m=document.querySelector(`#item_${c}`);if(m){const{x:b,y:d}=n.calculateItemPosition(o.x,o.y),{height:_,width:C}=n.calculateItemDimensions(o.height,o.width);$.set(m,{x:b,y:d,width:C,height:_})}}),h()),w.current=i},[i,n,h,a]),I.jsx("main",{ref:x,className:"bento-body",id:"bento_container",style:{height:D>0?`${D}px`:null,position:"relative",transition:"height 0.3s ease-out"},children:l})}function ot(){const s=N(R()),{divRef:G,width:r}=O(),[x,i]=g.useState(0),D=(n,e)=>{const u=L[n==null?void 0:n.toUpperCase()];return u?e in u?u[e]:(console.warn(`Key "${e}" is not found in GRID_CONFIG.${n}.`),null):(console.warn(`Device type "${n}" is not defined in GRID_CONFIG.`),null)};console.log(R());const P=S.BENTO_GRID_GAP,w=D(s,"MAX_COLUMNS"),f=M(r,P,w);g.useEffect(()=>{if(r===0)return;const n=y.map((l,t)=>({id:t,x:l.position[s.toLowerCase()].x,y:l.position[s.toLowerCase()].y,width:l.style[s.toLowerCase()].w,height:l.style[s.toLowerCase()].h}));let e=0;n.forEach(l=>{const t=l.y+l.height;t>e&&(e=t)});const{bento_fr:u,bento_gap:p,btm_margin:h}=f;let a=u*e;e>1&&(a+=p*(e-1)),i(a+h)},[r,s,f]);const E=g.useMemo(()=>r===0?[]:y.map((n,e)=>{const{h:u,w:p}=n.style[s.toLowerCase()],{x:h,y:a}=n.position[s.toLowerCase()],{height:l,width:t}=f.calculateItemDimensions(u,p),{x:o,y:c}=f.calculateItemPosition(h,a),m=`translate(${o}px, ${c}px)`;return I.jsx(B,{item:n,index:e,transform:m,height:l,width:t,isDragging:!1,"data-draggable-id":e},e)}),[r,f,s]);return I.jsx("main",{ref:G,className:"bento-body",id:"bento_container",style:{height:x>0?`${x}px`:null,position:"relative",transition:"height 0.3s ease-out"},children:E})}export{tt as Edit_Mode_Bento,ot as Viewer_Mode_Bento};
