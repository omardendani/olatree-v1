import{r as d,j as $}from"./index-Ch0d5zCX.js";import{u as J,g as v,D as Q}from"./useDragLogic-CMntdtcF.js";import{normalizeDeviceType as S,useDeviceType as A}from"./useDeviceType-BhtqrSY3.js";import{widgetItems as U,GENERAL_CONFIG as V,GRID_CONFIG as K}from"./bentoConfig-nF6itCGs.js";import{useDivWidth as X}from"./useDivWidth-G4P_3HpW.js";import{useCollisionSystem as Y}from"./useCollisionSystem-Dl6qQKGs.js";import{useGridCalculations as q}from"./useGridCalculations-BGDLqVEJ.js";import z from"./DraggableItem--Yv_hm04.js";import"./helpers-DDBqhmc4.js";import"./Items-CaLmxL1r.js";import"./Actions-CYSJFPcd.js";import"./getSiteInfo-BU7_39vT.js";import"./Icons-Cafj6oLt.js";v.registerPlugin(Q);function lo(){const h=U(),c=S(A()),p=S(c);function b(o,n){const s=K[o==null?void 0:o.toUpperCase()];return s?n in s?s[n]:(console.warn(`Key "${n}" is not found in GRID_CONFIG.${o}.`),null):(console.warn(`Device type "${o}" is not defined in GRID_CONFIG.`),null)}const{divRef:E,width:g}=X(),[R,O]=d.useState(0),I=d.useRef(g),y=V.BENTO_GRID_GAP,L=b(c,"MAX_COLUMNS"),t=q(g,y,L),r=Y(t);d.useRef({isDragging:!1,draggedItemId:null,previewElements:new Set,previewPositions:{},currentPositions:h?h.map((o,n)=>{var s,l,u,e,i,a,C,_;return{id:n,x:((l=(s=o==null?void 0:o.position)==null?void 0:s[p])==null?void 0:l.x)??0,y:((e=(u=o==null?void 0:o.position)==null?void 0:u[p])==null?void 0:e.y)??0,width:((a=(i=o==null?void 0:o.style)==null?void 0:i[p])==null?void 0:a.w)??1,height:((_=(C=o==null?void 0:o.style)==null?void 0:C[p])==null?void 0:_.h)??1}}):[]});const w=d.useCallback(o=>{let n=0;o.forEach(i=>{const a=i.y+i.height;a>n&&(n=a)});const{bento_fr:s,bento_gap:l,btm_margin:u}=t;let e=s*n;return n>1&&(e+=l*(n-1)),e+u},[t]),x=d.useCallback(()=>{if(f.getCurrentPositions){const o=f.getCurrentPositions(),n=w(o);O(n)}},[w]),f=J(g,t,r,x),D=d.useMemo(()=>!h||g===0?[]:h.map((o,n)=>{var G,P,M,W,H,j,B,F;const s=((P=(G=o==null?void 0:o.style)==null?void 0:G[p])==null?void 0:P.h)??1,l=((W=(M=o==null?void 0:o.style)==null?void 0:M[p])==null?void 0:W.w)??1,u=((j=(H=o==null?void 0:o.position)==null?void 0:H[p])==null?void 0:j.x)??0,e=((F=(B=o==null?void 0:o.position)==null?void 0:B[p])==null?void 0:F.y)??0,{height:i,width:a}=t.calculateItemDimensions(s,l),{x:C,y:_}=t.calculateItemPosition(u,e),N=`translate(${C}px, ${_}px)`;return $.jsx(z,{item:o,index:n,transform:N,height:i,width:a,isDragging:f.isDragging?f.isDragging():!1,"data-draggable-id":n},n)}),[g,t,p,h,f]);return d.useEffect(()=>{g>0&&x()},[g,x]),d.useEffect(()=>{g>0&&I.current!==g&&I.current>0&&((f.getCurrentPositions?f.getCurrentPositions():[]).forEach((n,s)=>{const l=document.querySelector(`#item_${s}`);if(l){const{x:u,y:e}=t.calculateItemPosition(n.x,n.y),{height:i,width:a}=t.calculateItemDimensions(n.height,n.width);v.set(l,{x:u,y:e,width:a,height:i})}}),x()),I.current=g},[g,t,x,f]),$.jsx("main",{ref:E,className:"bento-body",id:"bento_container",style:{height:R>0?`${R}px`:void 0,position:"relative",transition:"height 0.3s ease-out"},children:D.length>0&&D})}function go(){const h=U(),c=S(A()),{divRef:p,width:b}=X(),[E,g]=d.useState(0),R=(t,r)=>{const w=K[t==null?void 0:t.toUpperCase()];return w?r in w?w[r]:(console.warn(`Key "${r}" is not found in GRID_CONFIG.${t}.`),null):(console.warn(`Device type "${t}" is not defined in GRID_CONFIG.`),null)},O=V.BENTO_GRID_GAP,I=R(c,"MAX_COLUMNS"),y=q(b,O,I);d.useEffect(()=>{if(!h||b===0)return;const t=h.map((o,n)=>{var s,l,u,e,i,a,C,_;return{id:n,x:((l=(s=o==null?void 0:o.position)==null?void 0:s[c.toLowerCase()])==null?void 0:l.x)??0,y:((e=(u=o==null?void 0:o.position)==null?void 0:u[c.toLowerCase()])==null?void 0:e.y)??0,width:((a=(i=o==null?void 0:o.style)==null?void 0:i[c.toLowerCase()])==null?void 0:a.w)??1,height:((_=(C=o==null?void 0:o.style)==null?void 0:C[c.toLowerCase()])==null?void 0:_.h)??1}});let r=0;t.forEach(o=>{const n=o.y+o.height;n>r&&(r=n)});const{bento_fr:w,bento_gap:x,btm_margin:f}=y;let D=w*r;r>1&&(D+=x*(r-1)),g(D+f)},[b,c,y,h]);const L=d.useMemo(()=>!h||b===0?[]:h.map((t,r)=>{var e,i,a,C,_,N,G,P;const w=((i=(e=t==null?void 0:t.style)==null?void 0:e[c.toLowerCase()])==null?void 0:i.h)??1,x=((C=(a=t==null?void 0:t.style)==null?void 0:a[c.toLowerCase()])==null?void 0:C.w)??1,f=((N=(_=t==null?void 0:t.position)==null?void 0:_[c.toLowerCase()])==null?void 0:N.x)??0,D=((P=(G=t==null?void 0:t.position)==null?void 0:G[c.toLowerCase()])==null?void 0:P.y)??0,{height:o,width:n}=y.calculateItemDimensions(w,x),{x:s,y:l}=y.calculateItemPosition(f,D),u=`translate(${s}px, ${l}px)`;return $.jsx(z,{item:t,index:r,transform:u,height:o,width:n,isDragging:!1,"data-draggable-id":r},r)}),[b,y,c,h]);return $.jsx("main",{ref:p,className:"bento-body",id:"bento_container",style:{height:E>0?`${E}px`:void 0,position:"relative",transition:"height 0.3s ease-out"},children:L.length>0&&L})}export{lo as Edit_Mode_Bento,go as Viewer_Mode_Bento};
