import{r as d,j as E,u as z}from"./index-B_4oC6ka.js";import{u as J,g as B,D as Q}from"./useDragLogic-Co1hEvdf.js";import{normalizeDeviceType as W,useDeviceType as U}from"./useDeviceType-Cj8N1VZS.js";import{widgetItems as V,GRID_CONFIG as A}from"./bentoConfig-iXfgTRT9.js";import{useDivWidth as K}from"./useDivWidth-DXsB3FEv.js";import{useCollisionSystem as Y}from"./useCollisionSystem-B4JEUV-1.js";import{useGridCalculations as X}from"./useGridCalculations-BLxeMPWD.js";import q from"./DraggableItem-CS9X0-qL.js";import"./helpers-DDBqhmc4.js";import"./Items-CQIw-ghw.js";import"./Actions-DuMfgqjL.js";import"./getSiteInfo-BU7_39vT.js";import"./Icons-BwvYzIlD.js";B.registerPlugin(Q);function go(){const y=V(),_=W(U()),s=W(_);function S(o,t){const r=A[o==null?void 0:o.toUpperCase()];return r?t in r?r[t]:(console.warn(`Key "${t}" is not found in GRID_CONFIG.${o}.`),null):(console.warn(`Device type "${o}" is not defined in GRID_CONFIG.`),null)}const{divRef:x,width:c}=K(),[R,N]=d.useState(0),P=d.useRef(c),M=pageData.systemDesign.layout.widgets.gap,D=S(_,"MAX_COLUMNS"),u=X(c,M,D),n=Y(u);d.useRef({isDragging:!1,draggedItemId:null,previewElements:new Set,previewPositions:{},currentPositions:y?y.map((o,t)=>{var r,g,f,l,i,a,w,C;return{id:t,x:((g=(r=o==null?void 0:o.position)==null?void 0:r[s])==null?void 0:g.x)??0,y:((l=(f=o==null?void 0:o.position)==null?void 0:f[s])==null?void 0:l.y)??0,width:((a=(i=o==null?void 0:o.style)==null?void 0:i[s])==null?void 0:a.w)??1,height:((C=(w=o==null?void 0:o.style)==null?void 0:w[s])==null?void 0:C.h)??1}}):[]});const e=d.useCallback(o=>{let t=0;o.forEach(i=>{const a=i.y+i.height;a>t&&(t=a)});const{bento_fr:r,bento_gap:g,btm_margin:f}=u;let l=r*t;return t>1&&(l+=g*(t-1)),l+f},[u]),h=d.useCallback(()=>{if(p.getCurrentPositions){const o=p.getCurrentPositions(),t=e(o);N(t)}},[e]),p=J(c,u,n,h),I=d.useMemo(()=>!y||c===0?[]:y.map((o,t)=>{var G,$,L,H,O,j,v,F;const r=(($=(G=o==null?void 0:o.style)==null?void 0:G[s])==null?void 0:$.h)??1,g=((H=(L=o==null?void 0:o.style)==null?void 0:L[s])==null?void 0:H.w)??1,f=((j=(O=o==null?void 0:o.position)==null?void 0:O[s])==null?void 0:j.x)??0,l=((F=(v=o==null?void 0:o.position)==null?void 0:v[s])==null?void 0:F.y)??0,{height:i,width:a}=u.calculateItemDimensions(r,g),{x:w,y:C}=u.calculateItemPosition(f,l),b=`translate(${w}px, ${C}px)`;return E.jsx(q,{item:o,index:t,transform:b,height:i,width:a,isDragging:p.isDragging?p.isDragging():!1,"data-draggable-id":t},t)}),[c,u,s,y,p]);return d.useEffect(()=>{c>0&&h()},[c,h]),d.useEffect(()=>{c>0&&P.current!==c&&P.current>0&&((p.getCurrentPositions?p.getCurrentPositions():[]).forEach((t,r)=>{const g=document.querySelector(`#item_${r}`);if(g){const{x:f,y:l}=u.calculateItemPosition(t.x,t.y),{height:i,width:a}=u.calculateItemDimensions(t.height,t.width);B.set(g,{x:f,y:l,width:a,height:i})}}),h()),P.current=c},[c,u,h,p]),E.jsx("main",{ref:x,className:"bento-body",id:"bento_container",style:{height:R>0?`${R}px`:void 0,position:"relative",transition:"height 0.3s ease-out"},children:I.length>0&&I})}function lo(){const y=z(),_=V(),s=W(U()),{divRef:S,width:x}=K(),[c,R]=d.useState(0),N=(n,e)=>{const h=A[n==null?void 0:n.toUpperCase()];return h?e in h?h[e]:(console.warn(`Key "${e}" is not found in GRID_CONFIG.${n}.`),null):(console.warn(`Device type "${n}" is not defined in GRID_CONFIG.`),null)},P=y.systemDesign.layout.widgets.gap,M=N(s,"MAX_COLUMNS"),D=X(x,P,M);d.useEffect(()=>{if(!_||x===0)return;const n=_.map((t,r)=>{var g,f,l,i,a,w,C,b;return{id:r,x:((f=(g=t==null?void 0:t.position)==null?void 0:g[s.toLowerCase()])==null?void 0:f.x)??0,y:((i=(l=t==null?void 0:t.position)==null?void 0:l[s.toLowerCase()])==null?void 0:i.y)??0,width:((w=(a=t==null?void 0:t.style)==null?void 0:a[s.toLowerCase()])==null?void 0:w.w)??1,height:((b=(C=t==null?void 0:t.style)==null?void 0:C[s.toLowerCase()])==null?void 0:b.h)??1}});let e=0;n.forEach(t=>{const r=t.y+t.height;r>e&&(e=r)});const{bento_fr:h,bento_gap:p,btm_margin:I}=D;let o=h*e;e>1&&(o+=p*(e-1)),R(o+I)},[x,s,D,_]);const u=d.useMemo(()=>!_||x===0?[]:_.map((n,e)=>{var i,a,w,C,b,G,$,L;const h=((a=(i=n==null?void 0:n.style)==null?void 0:i[s.toLowerCase()])==null?void 0:a.h)??1,p=((C=(w=n==null?void 0:n.style)==null?void 0:w[s.toLowerCase()])==null?void 0:C.w)??1,I=((G=(b=n==null?void 0:n.position)==null?void 0:b[s.toLowerCase()])==null?void 0:G.x)??0,o=((L=($=n==null?void 0:n.position)==null?void 0:$[s.toLowerCase()])==null?void 0:L.y)??0,{height:t,width:r}=D.calculateItemDimensions(h,p),{x:g,y:f}=D.calculateItemPosition(I,o),l=`translate(${g}px, ${f}px)`;return E.jsx(q,{item:n,index:e,transform:l,height:t,width:r,isDragging:!1,"data-draggable-id":e},e)}),[x,D,s,_]);return E.jsx("main",{ref:S,className:"bento-body",id:"bento_container",style:{height:c>0?`${c}px`:void 0,position:"relative",transition:"height 0.3s ease-out"},children:u.length>0&&u})}export{go as Edit_Mode_Bento,lo as Viewer_Mode_Bento};
